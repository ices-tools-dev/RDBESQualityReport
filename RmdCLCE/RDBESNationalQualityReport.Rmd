---
# date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document:
    toc: true
    toc_depth: 4
    number_sections: true
    toc_float: true
params:
  year: year
  region: region
  RDBESfile: RDBESfile
  eurostat: eurostat
  prelcatchstat: prelcatchstat
  prelcatchFile: prelcatchFile
  fleetRegister: fleetRegister
  fleetRegisterFile: fleetRegisterFile
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, fig.height = 12, fig.width = 14)
options(scipen=999)
```

```{r}
# Packages 
# TODO add automatic install for packages if they do not exist 
library(icesVocab)
library(tidyverse, quietly = TRUE)
library(eurostat)
library(DT)
# library(RDBEScore)
```


```{r}
# Functions 
source("../Functions/read.rdbes.R")
```

---
title: National quality report for year(s) `r params$year`
---


```{r}
# Read RDBES CL, CE files 
# df <- createRDBESDataObject(params$RDBESfile) # overwrites if given multiple zip files with the same tables
# check what happens if all years are in one zip folder when time series are uploaded 
# For now use this 
df <- read.rdbes(params$RDBESfile)
CL <- as.data.frame(df[1])
CE <- as.data.frame(df[2])
```

```{r, eval = params$eurostat}
# Auxiliary information for comparisons 
# 1. Eurostat data - weight 
eurostatW <- get_eurostat("tag00076", time_format = "num", filters = list(geo = unique(CL$CLlandingCountry)), stringsAsFactors = TRUE) # tag corresponds to catches in all fishing regions by country
# https://ec.europa.eu/eurostat/databrowser/view/tag00076/default/table?lang=en&category=t_fish

# 2. Eurostat data - number of vessels 
# eurostatV <- get_eurostat("tag00076", time_format = "num", filters = list(geo = unique(CL$CLlandingCountry)), stringsAsFactors = TRUE)

```

```{r}
# 2. ICES preliminary catches
# Need to download the zip(s) from ICES? can it be fetched otherwise? I only see 2021 - 2022 prel catch statistics in the ices web 

```

```{r}
# 3. Fleet register 
# The fleet data in the eurostat datasets are not clear. Could they be used? 
```


```{r}
# Processing 
# Get species scientific name from aphiaID
ScName <- getCodeList("SpecWorms") %>%
  select(Description, Key)
CL <- left_join(CL, ScName, by = c("CLspeciesCode" = "Key")) 
```

```{r}
# Merge CL, CE tables 


```

# Summary 

Add text with a brief summary describing what the document's purpose is etc. 

```{r,  child = '01_Eurostat.Rmd', eval = params$eurostat}

```




# CL 

# CE

# CL & CE 
